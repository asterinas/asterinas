[project]
type = "kernel"

[run]
kcmd_args = [
    "SHELL=/bin/sh",
    "LOGNAME=root",
    "HOME=/",
    "USER=root",
    "PATH=/bin:/benchmark",
    "init=/usr/bin/busybox",
]
init_args = ["sh", "-l"]
initramfs = "/usr/bin/bash"
boot_protocol = "multiboot2"
bootloader = "grub"
ovmf = "/usr/bin/bash"
opensbi = "/usr/bin/bash"
drive_files = [
    ["/usr/bin/bash", "if=none,format=raw,id=x0"],
    ["/usr/bin/bash", "if=none,format=raw,id=x1"],
]
qemu_args = [
    "-machine q35,kernel-irqchip=split",
    "-cpu Icelake-Server,+x2apic",
    "--no-reboot",
    "-m 2G",
    "-nographic",
    "-serial chardev:mux",
    "-monitor chardev:mux",
    "-chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log",
    "-display none",
    "-device isa-debug-exit,iobase=0xf4,iosize=0x04",
    "-object filter-dump,id=filter0,netdev=net01,file=virtio-net.pcap",
    "-netdev user,id=net01,hostfwd=tcp::36788-:22,hostfwd=tcp::55834-:8080",
    "-device virtio-blk-pci,bus=pcie.0,addr=0x6,drive=x0,serial=vext2,disable-legacy=on,disable-modern=off",
    "-device virtio-blk-pci,bus=pcie.0,addr=0x7,drive=x1,serial=vexfat,disable-legacy=on,disable-modern=off",
    "-device virtio-keyboard-pci,disable-legacy=on,disable-modern=off",
    "-device virtio-net-pci,netdev=net01,disable-legacy=on,disable-modern=off",
    "-device virtio-serial-pci,disable-legacy=on,disable-modern=off",
    "-device virtconsole,chardev=mux",
]

['cfg(arch="x86_64", schema="iommu")'.run]
drive_files = [
    ["/usr/bin/bash", "if=none,format=raw,id=x0"],
    ["/usr/bin/bash", "if=none,format=raw,id=x1"],
]
qemu_args = [
    "-machine q35,kernel-irqchip=split",
    "-cpu Icelake-Server,+x2apic",
    "--no-reboot",
    "-m 2G",
    "-nographic",
    "-serial chardev:mux",
    "-monitor chardev:mux",
    "-chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log",
    "-display none",
    "-device isa-debug-exit,iobase=0xf4,iosize=0x04",
    "-object filter-dump,id=filter0,netdev=net01,file=virtio-net.pcap",
    "-netdev user,id=net01,hostfwd=tcp::36788-:22,hostfwd=tcp::55834-:8080",
    "-device virtio-blk-pci,bus=pcie.0,addr=0x6,drive=x0,serial=vext2,disable-legacy=on,disable-modern=off,iommu_platform=on,ats=on",
    "-device virtio-blk-pci,bus=pcie.0,addr=0x7,drive=x1,serial=vexfat,disable-legacy=on,disable-modern=off,iommu_platform=on,ats=on",
    "-device virtio-keyboard-pci,disable-legacy=on,disable-modern=off,iommu_platform=on,ats=on",
    "-device virtio-net-pci,netdev=net01,disable-legacy=on,disable-modern=off,iommu_platform=on,ats=on",
    "-device virtio-serial-pci,disable-legacy=on,disable-modern=off,iommu_platform=on,ats=on",
    "-device virtconsole,chardev=mux",
    "-device intel-iommu,intremap=on,device-iotlb=on",
    "-device ioh3420,id=pcie.0,chassis=1",
]

['cfg(arch="x86_64", schema="microvm")'.run]
bootloader = "qemu"
drive_files = [
    ["/usr/bin/bash", "if=none,format=raw,id=x0"],
    ["/usr/bin/bash", "if=none,format=raw,id=x1"],
]
qemu_args = [
    "-machine microvm,rtc=on",
    "-cpu Icelake-Server,+x2apic",
    "--no-reboot",
    "-m 2G",
    "-nographic",
    "-serial chardev:mux",
    "-monitor chardev:mux",
    "-chardev stdio,id=mux,mux=on,signal=off,logfile=qemu.log",
    "-display none",
    "-device isa-debug-exit,iobase=0xf4,iosize=0x04",
    "-object filter-dump,id=filter0,netdev=net01,file=virtio-net.pcap",
    "-netdev user,id=net01,hostfwd=tcp::36788-:22,hostfwd=tcp::55834-:8080",
    "-nodefaults",
    "-no-user-config",
    "-device virtio-blk-device,drive=x0,serial=vext2",
    "-device virtio-blk-device,drive=x1,serial=vexfat",
    "-device virtio-keyboard-device",
    "-device virtio-net-device,netdev=net01",
    "-device virtio-serial-device",
    "-device virtconsole,chardev=mux",
]

['cfg(schema="intel_tdx")'.run]
qemu_exe = "/usr/bin/bash"

['cfg(arch="riscv64")'.run]
qemu_args = [
    "-machine virt",
    "--no-reboot",
    "-m 2G",
    "-nographic",
]
